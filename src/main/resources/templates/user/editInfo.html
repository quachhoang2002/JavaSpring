<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
    />
    <title>Document</title>
    <!-- Font Awesome -->
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
            href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
            rel="stylesheet"
    />
    <!-- MDB -->
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.css"
            rel="stylesheet"
    />
    <link
            rel="icon"
            type="image/x-icon"
            href="assets/favicon.ico"
    />
    <!-- Bootstrap icons-->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
            rel="stylesheet"
    />
    <style>
        .gradient-custom-2 {
            /* fallback for old browsers */
            background: #fbc2eb;

            /* Chrome 10-25, Safari 5.1-6 */
            background: -webkit-linear-gradient(
                to right,
                rgba(251, 194, 235, 1),
                rgba(166, 193, 238, 1)
            );

            /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
            background: linear-gradient(
                to right,
                rgba(251, 194, 235, 1),
                rgba(166, 193, 238, 1)
            );
        }
    </style>
    <style>
        a {
            text-decoration: none;
            color: black;
        }
        .buttons-noti {
            padding: 10px;
        }
        .notifications {
            display: flex;
            position: fixed;
            z-index: 999;
            top: 30px;
            right: 200px;
            height: 200px;
            width: 200px;
        }
        .toastPopup {
            cursor: pointer;
            position: relative;
            padding: 10px;
            color: #fff;
            margin-bottom: 10px;
            width: 400px;
            display: grid;
            grid-template-columns: 70px 1fr 70px;
            border-radius: 5px;
            --color: #0abf30;
            background-image: linear-gradient(
                to right,
                #0abf3055,
                #22242f 30%
            );
            animation: show 0.3s ease 1 forwards;
        }
        .toastPopup i {
            color: var(--color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: x-large;
        }
        .toastPopup .title {
            font-size: x-large;
            font-weight: bold;
        }
        .toastPopup span,
        .toastPopup i:nth-child(3) {
            color: #fff;
            opacity: 0.6;
        }
        @keyframes show {
            0% {
                transform: translateX(100%);
            }
            40% {
                transform: translateX(-5%);
            }
            80% {
                transform: translateX(0%);
            }
            100% {
                transform: translateX(-10%);
            }
        }
        .toastPopup::before {
            position: absolute;
            bottom: 0;
            left: 0;
            background-color: var(--color);
            width: 100%;
            height: 3px;
            content: '';
            box-shadow: 0 0 10px var(--color);
            animation: timeOut 5s linear 1 forwards;
        }
        @keyframes timeOut {
            to {
                width: 0;
            }
        }
        .toastPopup.error {
            --color: #f24d4c;
            background-image: linear-gradient(
                to right,
                #f24d4c55,
                #22242f 30%
            );
        }
        .toastPopup.warning {
            --color: #e9bd0c;
            background-image: linear-gradient(
                to right,
                #e9bd0c55,
                #22242f 30%
            );
        }
        .toastPopup.info {
            --color: #3498db;
            background-image: linear-gradient(
                to right,
                #3498db55,
                #22242f 30%
            );
        }
    </style>
</head>
<body>
<section class="h-100 gradient-custom-2">
    <div class="container py-5 h-100">
        <div
                class="row d-flex justify-content-center align-items-center h-100"
        >
            <div class="col col-lg-9 col-xl-7">
                <div style="width: 5%">
                    <button
                            type="button"
                            class="btn btn-outline-dark"
                            data-mdb-ripple-color="secondary    "
                            onclick="window.history.back();"
                            style="z-index: 1; margin: 2px"
                    >
                        Back
                    </button>
                </div>
                <div class="card">
                    <div
                            class="rounded-top text-white d-flex flex-row"
                            style="background-color: #000; height: 200px"
                    >
                        <div
                                class="ms-4 mt-5 d-flex flex-column"
                                style="width: 150px"
                        >
                            <img
                                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-profiles/avatar-1.webp"
                                    alt="Generic placeholder image"
                                    class="img-fluid img-thumbnail mt-4 mb-2"
                                    style="width: 150px; z-index: 1"
                            />

                            <button
                                    type="button"
                                    class="btn btn-outline-dark"
                                    data-mdb-ripple-color="dark"
                                    style="z-index: 1; margin-top: 2px"
                                    onclick="saveChanges()"
                            >
                                Save changes
                            </button>
                        </div>
                        <div
                                class="ms-3"
                                style="margin-top: 130px"
                        >
                            <h5>Andy Horwitz</h5>
                            <p>New York</p>
                        </div>
                    </div>

                    <div
                            class="p-4 text-black"
                            style="background-color: #f8f9fa; height: 90px"
                    >
                        <div
                                class="d-flex justify-content-end text-center py-1"
                        ></div>
                    </div>
                    <div class="card-body p-4 text-black">
                        <div class="mb-5">
                            <p class="lead fw-normal mb-1">INFO</p>
                            <div
                                    class="p-4"
                                    style="
                                            background-color: #f8f9fa;
                                            display: flex;
                                            flex-direction: column;
                                            gap: 40px;
                                        "
                            >
                                <div class="form-outline">
                                    <label
                                            class="label"
                                            for="typeText"
                                    >Name:</label
                                    >
                                    <input
                                            type="text"
                                            id="typeText"
                                            class="form-control border border-secondary"
                                    />
                                </div>
                                <div class="form-outline">
                                    <label
                                            class="label"
                                            for="typePassword"
                                    >Password:</label
                                    >
                                    <input
                                            type="password"
                                            value=""
                                            id="typePassword"
                                            class="form-control border border-secondary"
                                    />
                                </div>
                                <div class="form-outline">
                                    <label
                                            class="label"
                                            for="typeEmail"
                                    >Email:</label
                                    >
                                    <input
                                            type="email"
                                            id="typeEmail"
                                            class="form-control border border-secondary"
                                    />
                                </div>
                                <div class="form-outline">
                                    <label
                                            class="label"
                                            for="typePhone"
                                    >Phone number:</label
                                    >
                                    <input
                                            type="tel"
                                            id="typePhone"
                                            class="form-control border border-secondary"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div
        class="notifications"
        id="notifications"
></div>
<script src="/js/ultils.js"></script>
<script>
    window.onload = function () {
        loadData();
    };
    function isValidPhoneNumber(phoneNumber) {
    // Biểu thức chính quy kiểm tra số điện thoại Việt Nam (không kiểm tra xác thực thực tế của số điện thoại)
    const vietnamPhoneNumberRegex = /^(0[1-9][0-9]{8}|84[1-9][0-9]{8})$/;

    // Sử dụng test() để kiểm tra chuỗi phoneNumber với biểu thức chính quy
    return vietnamPhoneNumberRegex.test(phoneNumber);
}
    function loadData() {
        const user = JSON.parse(localStorage.getItem('user'));
        document.getElementById('typeEmail').value = user.email;
        document.getElementById('typeText').value = user.name;
        document.getElementById('typePassword').value = user.password;
        document.getElementById('typePhone').value = user.phone;
    }
    function isValidEmail(email) {
        // Sử dụng biểu thức chính quy (regex) để kiểm tra tính hợp lệ của email
        const emailRegex =
            /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        return emailRegex.test(email);
    }
    function saveChanges() {
        const email = document.getElementById('typeEmail').value;
        const name = document.getElementById('typeText').value;
        const password = document.getElementById('typePassword').value;
        const phone = document.getElementById('typePhone').value;
        // Lấy thông tin người dùng từ localStorage
        const storedUser = JSON.parse(localStorage.getItem('user'));
        if (
            email === storedUser.email &&
            name === storedUser.name &&
            phone === storedUser.phone &&
            password === storedUser.password
        ) {
            createToast(
                'error',
                'bi-check-circle',
                'Error',
                'Bạn chưa thay đổi gì'
            );
            return;
        }
        // Kiểm tra mật khẩu có đủ điều kiện
        if (password.length < 8 || password.length > 14) {
            createToast(
                'error',
                'bi-check-circle',
                'Error',
                'Mật khẩu phải từ 8 đến 14 ký tự.'
            );
            return;
        }
        if (!isValidEmail(email)) {
            createToast(
                'error',
                'bi-check-circle',
                'Error',
                'Email không hợp lệ'
            );
            return;
        }
        if (!isValidPhoneNumber(phone)){
            createToast(
                'error',
                'bi-check-circle',
                'Error',
                'Số điện thoại không hợp lệ'
            );
            return;
        }

        // Tạo một đối tượng chứa thông tin người dùng
        const updatedUser = {
            id: storedUser.id,
            email: email,
            name: name,
            phone: phone,
            password: storedUser.password
        };
        // Kiểm tra mật khẩu có thay đổi không
        if (password !== storedUser.password) {
            updatedUser.password = password
        }
        console.log(updatedUser)


        // Gửi yêu cầu PUT đến API
        fetch('http://localhost:8081/api/auth/editUser', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(updatedUser),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.status == 'success') {
                    localStorage.setItem('user', JSON.stringify(data.data));
                    createToast(
                        'success',
                        'bi-check-circle',
                        'Success',
                        'Cập nhật thông tin thành công'
                    );
                    loadData();
                } else {
                    createToast(
                        'error',
                        'bi-check-circle',
                        'error',
                        'Cập nhật thông tin thất bại'
                    );
                    console.log(data)
                }
            })
            .catch((error) => {
                console.error('Lỗi:', error);
            });
    }
</script>
</body>
</html>
