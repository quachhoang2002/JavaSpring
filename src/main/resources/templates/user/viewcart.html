<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <h1>View Cart</h1>
    <ul id="cartList"></ul>
    <a id="clearCartButton" href="/cart">Add more</a>
<script>
    document.addEventListener("DOMContentLoaded", function () {
    const cartList = document.getElementById("cartList");
    const clearCartButton = document.getElementById("clearCartButton");

    // Function to fetch cart items from the server
    function fetchCartItems() {
        fetch("http://localhost:8081/api/cart/getAll")
            .then((response) => response.json())
            .then((cartItems) => {
                // Display cart items on the page
                cartList.innerHTML = "";
                cartItems.forEach((item) => {
                    const cartItem = document.createElement("li");
                    cartItem.innerHTML = `
                        ${item.product.name} - $${item.product.price} x ${item.quantity}
                        <button class="removeCartItem" data-id='${item.id}'>Remove</button>
                    `;
                    cartList.appendChild(cartItem);
                });
            })
            .catch((error) => {
                console.error("Error fetching cart items:", error);
            });
    }

    // Fetch cart items when the page loads
    fetchCartItems();

    // Event listener for removing items from the cart
    cartList.addEventListener("click", (event) => {
        if (event.target.classList.contains("removeCartItem")) {
            const cartItemId = event.target.getAttribute("data-id");

            // Send a request to remove the item from the cart
            fetch(`http://localhost:8081/api/cart/delete/${cartItemId}`, {
                method: "DELETE",
            })
                .then((response) => {
                    if (response.ok) {
                        // If the item is successfully removed, fetch updated cart items
                        fetchCartItems();
                    } else {
                        console.error("Error removing cart item.");
                    }
                })
                .catch((error) => {
                    console.error("Error removing cart item:", error);
                });
        }
    });

    // Event listener for clearing the entire cart
    clearCartButton.addEventListener("click", () => {
        // Send a request to clear the entire cart
        fetch("http://localhost:8081/api/cart/delete/", {
            method: "DELETE",
        })
            .then((response) => {
                if (response.ok) {
                    // If the cart is successfully cleared, fetch updated cart items
                    fetchCartItems();
                } else {
                    console.error("Error clearing cart.");
                }
            })
            .catch((error) => {
                console.error("Error clearing cart:", error);
            });
    });
});

</script>
</body>
</html>